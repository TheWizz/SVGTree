<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	<link rel="stylesheet" type="text/css" href="../svgtree.css" />
	<link rel="stylesheet" type="text/css" href="svgtree-viewer.css" />
	<link rel="stylesheet" type="text/css" href="../demo.css" />
	<!-- jQuery is not required by SVGTree. It's here to simplify the code of examples. -->
	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="../svgtree.js"></script>
	<script src="svgtree-viewer.js"></script>
	
	<script>
	/**
	 * Generates a random rooted tree.
	 */
	function randomTree(nodes, maxChildren) {
		var tree = new Tree();
		tree.data = '0';
		
		var queue = [ tree ];
		while (queue.length < nodes) {
			var i = -1;
			do {
				i = Math.floor(Math.random() * queue.length);
			} while (queue[i].children.length >= maxChildren);
			
			var node = queue[i], child = new Tree();
			// Add a child to the node
			child.data = '' + queue.length;
			node.append(child);
			queue.push(child);
			
			if (node.children.length == 1) {
				// Don't let nodes in the tree with a single child
				child = new Tree();
				child.data = '' + queue.length;
				node.append(child);
				queue.push(child);
			}
		}
		
		// Permutate the children of each node (if we don't do that, leftmost nodes will have
		// more children).
		
		for (var i = 0; i < queue.length; i++) {
			var node = queue[i], ch = node.children;
			if (ch.length > 0) {
				var x = Math.floor(Math.random() * ch.length),
					y = Math.floor(Math.random() * ch.length);
				
				var t = ch[x]; ch[x] = ch[y]; ch[y] = t;
			}
		}
		
		return tree;
	}
	
	$(function(){ 
		function prepareScript(script) {
			var lines = script.split(/\n/), nTabs = 0;
			lines.splice(0, 1); // The first line is whitespace only
			
			while (lines[0][nTabs] == '\t') nTabs++;
			
			for (var i = 0; i < lines.length; i++) {
				lines[i] = lines[i].substring(nTabs);
				lines[i] = lines[i].replace(/\t/g, '    ');
			}
			return lines.join('\n');
		}
	
		$('pre.code').each(function() {
			var el = $(this),
				script = $('#' + el.data('script')).text();
			$(this).text(prepareScript(script));
		});
	});
	</script>
	
	<title>SVGTreeViewer Demo</title>
</head>
<body>
	<h1>SVGTreeViewer Demo</h1>
	
	<p>The examples on this page showcase the basic functionality of the SVGTreeViewer widget.</p>

	<div class="row">
		<div id="test-viewer" title="Test tree"></div>
		
		<h4>Code</h4>
		<pre class="code" data-script="test-basic-src"></pre>
		
		<script id="test-basic-src">
		var container = document.getElementById('test-viewer');
		SVGTreeViewer('((A,B),(C,D)F)E;', container, {
			// You can specify the same settings as for SVGTree
			'interaction': ['collapse', 'add', 'remove', 'edit', 'drag']
		});
		</script>
	</div>
	
	<div class="row">
		<div id="test-buttons" title="Testing buttons"></div>
		
		<p>You can disable undo, settings and / or Newick notation buttons by specifying appropriate boolean options (<code>undo</code>, <code>settings</code>, <code>newick</code>).</p>
		
		<h4>Code</h4>
		<pre class="code" data-script="test-buttons-src"></pre>
		
		<script id="test-buttons-src">
		var container = document.getElementById('test-buttons');
		SVGTreeViewer('((A,B),(C,D)F)E;', container, {
			'interaction': ['collapse', 'add', 'remove', 'edit', 'drag'],
			'newick': false,
			'undo': false
		});
		</script>
	</div>
	
	<div class="row">
		<div id="test-footer" title="Testing footer"></div>
		
		<p>Alternatively, the footer containing node-specific actions can be removed altogether using the <code>footer</code> option.
		The footer is removed automatically if tree nodes cannot be selected.</p>
		
		<h4>Code</h4>
		<pre class="code" data-script="test-footer-src"></pre>
		
		<script id="test-footer-src">
		var container = document.getElementById('test-footer');
		SVGTreeViewer('((A,B),(C,D)F)E;', container, {
			'interaction': ['collapse'],
			'footer': false
		});
		</script>
	</div>
	
	<div class="row">
		<p>You can specify the size of a widget using width and / or height styles (e.g., using <code>&lt;div ... style="width: 800px; height: 600px;" &gt;</code>).</p>
	
		<div id="test-size" title="Testing width and height" style="width: 800px; height: 600px;"></div>
	
		<p>Note that for the optimal layout, the width of the widget should be no less than <code>400px</code>, and its height no less than <code>300px</code>.</p>
	
		<div id="test-width" title="Testing width" style="width: 400px; height: 300px;"></div>
		
		
		<h4>Code</h4>
		<pre class="code" data-script="test-size-src"></pre>
		
		<script id="test-size-src">
		var container = document.getElementById('test-width');
		SVGTreeViewer('((A,B),(C,D)F)E;', container, {
			'interaction': false
		});
		
		container = document.getElementById('test-size');
		SVGTreeViewer('((A,(1,,(3,(5,6,7)4)2)B),(C,D)F)E;', container, {
			'interaction': ['collapse', 'add', 'remove', 'edit', 'drag']
		});
		</script>
	</div>
	
	<div class="row">
		<div id="test-max" title="Random tree" style="width: 600px; height: 600px;"></div>
		
		<p>For large trees, there is a useful Locate button which centers the displayed area of the tree on the selected node.</p>
	
		<h4>Code</h4>
		<pre class="code" data-script="test-max-src"></pre>
		
		<script id="test-max-src">
		(function() {
			// randomTree is a function that generates random trees
			// (you can inspect it by viewing the source code of this file).
		
			var container = document.querySelector('#test-max'),
				nodes = 300, // Number of nodes in the tree
				maxChildren = 4, // Maximum number of children of each node
				notation = randomTree(nodes, maxChildren).newick();
			var tree = new SVGTreeViewer(notation, container, {
				'interaction': ['collapse'],
				'labelBackgrounds': false
			});
			
			$('#test-max-gen').click(function() {
				tree.setContent(randomTree(nodes, maxChildren).newick());
			});
		})();
		</script>
	</div>
</body>
</html>
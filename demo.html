<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<link rel="stylesheet" type="text/css" href="svgtree.css" />
	<link rel="stylesheet" type="text/css" href="demo.css" />
	<!-- jQuery is not required by SVGTree. It's here to simplify the code of examples. -->
	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="svgtree.js"></script>
	
	<script>
	/**
	 * Generates a random rooted tree.
	 */
	function randomTree(nodes, maxChildren) {
		var tree = new Tree();
		tree.data = '0';
		
		var queue = [ tree ];
		while (queue.length < nodes) {
			var i = -1;
			do {
				i = Math.floor(Math.random() * queue.length);
			} while (queue[i].children.length >= maxChildren);
			
			var node = queue[i], child = new Tree();
			// Add a child to the node
			child.data = '' + queue.length;
			node.append(child);
			queue.push(child);
			
			if (node.children.length == 1) {
				// Don't let nodes in the tree with a single child
				child = new Tree();
				child.data = '' + queue.length;
				node.append(child);
				queue.push(child);
			}
		}
		
		// Permutate the children of each node (if we don't do that, leftmost nodes will have
		// more children).
		
		for (var i = 0; i < queue.length; i++) {
			var node = queue[i], ch = node.children;
			if (ch.length > 0) {
				var x = Math.floor(Math.random() * ch.length),
					y = Math.floor(Math.random() * ch.length);
				
				var t = ch[x]; ch[x] = ch[y]; ch[y] = t;
			}
		}
		
		return tree;
	}
	
	$(function(){ 
		function prepareScript(script) {
			var lines = script.split(/\n/), nTabs = 0;
			lines.splice(0, 1); // The first line is whitespace only
			
			while (lines[0][nTabs] == '\t') nTabs++;
			
			for (var i = 0; i < lines.length; i++) {
				lines[i] = lines[i].substring(nTabs);
				lines[i] = lines[i].replace(/\t/g, '    ');
			}
			return lines.join('\n');
		}
	
		$('pre.code').each(function() {
			var el = $(this),
				script = $('#' + el.data('script')).text();
			$(this).text(prepareScript(script));
		});
	});
	</script>
	
	<title>SVGTree Demo</title>
</head>
<body>
	<h1>SVGTree Demo</h1>
	
	<p>The examples on this page showcase the basic functionality of the trees made with SVGTree.
	The code fragments below use jQuery. It is not required by SVGTree, but used to simplify the code of examples.</p>
	
	<div class="row">
		<figure>
			<div id="test-init"></div>
		</figure>
		<div class="notes">
			<p>Trees can be created using the <code>SVGTree</code> function. The function accepts the three arguments:
			the <a href="http://en.wikipedia.org/wiki/Newick_format">Newick notation</a>, the container element (usually, a &lt;DIV&gt;), 
			and (optionally) display options.</p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-init-src"></pre>
		</div>
		
		<script id="test-init-src">
		(function() {
			// In HTML:
			// <div id="test-init"></div>

			var svg = document.querySelector('#test-init');
			new SVGTree('(A,B)C;', svg);
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-newick"></div>
		</figure>
		<div class="notes">
			<p>To include special characters (<code>,();</code>) associated with the nodes of the tree, escape them with a backslash <code>\</code>.</p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-newick-src"></pre>
		</div>
		
		<script id="test-newick-src">
		(function() {
			var container = document.querySelector('#test-newick'),
				options = {
					'leafDistance': 50 // widen the tree a little
				};

			new SVGTree('(s\l\a\sh\\\\,node,(node 2,comma \\,)\\(parentheses\\))root;', 
				container, options);
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-edges-nodes"></div>
		</figure>
		<div class="notes">
			<p>Options allow to change the presentation of the tree. For example, <code>edges</code> parameter
			controls the shape of the edges (angular or straight), and <code>nodes</code> parameter determines
			the shape of the nodes.</p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-edges-nodes-src"></pre>
		</div>
		
		<script id="test-edges-nodes-src">
		(function() {
			var container = document.querySelector('#test-edges-nodes');
			new SVGTree('(A,),(B,C),(D,E))R;', container, {
				'nodes': 'square',
				'edges': 'straight'
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-hmode"></div>
		</figure>
		<div class="notes">
			<p>In addition to the vertical mode (children below their ancestors), the tree can be rendered in the horizontal mode
			(children to the right of their ancestors).</p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-hmode-src"></pre>
		</div>
		
		<script id="test-hmode-src">
		(function() {
			var container = document.querySelector('#test-hmode');
			new SVGTree('(A,),(B,C),(D,E))R;', container, {
				'orientation': 'h'
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-resize"></div>
		</figure>
		<div class="notes">
			<p>By default, the size of the SVG element where the tree is drawn isn't set, which means you should specify it,
			e.g. using CSS. This behavior can be changed by setting <code>size</code> option to <code>'fit'</code> (to fit the tree), 
			or an array of the two values (width and height of the SVG element in pixels).</p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-resize-src"></pre>
		</div>
		
		<script id="test-resize-src">
		(function() {
			var container = document.querySelector('#test-resize');
			new SVGTree('(A,),(B,C),(D,E))R;', container, {
				'size': 'fit'
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-collapse"></div>
		</figure>
		<div class="notes">
			<p>The tree may respond to the user events. The degree of interaction can be tuned using <code>interaction</code> option, 
			which takes an array of possible interactions.
			For example, you can allow to collapse and expand tree nodes; these operations don't actually modify the tree.
			To collapse or expand a node, double click on it or use space or enter keys.</p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-collapse-src"></pre>
		</div>
		
		<script id="test-collapse-src">
		(function() {
			var container = document.querySelector('#test-collapse');
			new SVGTree('((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;', container, {
				'interaction': ['collapse']
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-edit"></div>
		</figure>
		<div class="notes">
			<p>To allow editing the tree, set <code>interaction</code> option to <code>'edit'</code>.
			This allows editing node tags.</p>
			
			<p><button id="test-edit-restore">Restore original tree</button></p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-edit-src"></pre>
		</div>
		
		<script id="test-edit-src">
		(function() {
			var container = document.querySelector('#test-edit'),
				notation = '((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;';
			var tree = new SVGTree(notation, container, {
				'interaction': ['edit']
			});
			
			$('#test-edit-restore').click(function() {
				// We can use SVGTree.setContent function to quickly change
				// the entire tree
				tree.setContent(notation);
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-rearrange"></div>
		</figure>
		<div class="notes">
			<p>If you specify <code>'rearrange'</code> option in <code>interaction</code>, the sibling nodes 
			can be rearranged by dragging. Note that this option doesn't change the semantics of the tree 
			for most applications.</p>
			
			<p><button id="test-rearrange-restore">Restore original tree</button></p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-rearrange-src"></pre>
		</div>
		
		<script id="test-rearrange-src">
		(function() {
			var container = document.querySelector('#test-rearrange'),
				notation = '((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;';
			var tree = new SVGTree(notation, container, {
				'interaction': ['rearrange']
			});
			
			$('#test-rearrange-restore').click(function() {
				tree.setContent(notation);
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-add"></div>
		</figure>
		<div class="notes">
			<p>To allow adding and removing nodes from the tree, you may use <code>'add'</code> and <code>'remove'</code>
			options, respectively. Nodes can be removed from the tree using delete key and added using insert key.
			Note that to edit the labels of the newly created nodes, you have to specify <code>'edit'</code> option together 
			with <code>'add'</code>.</p>
			
			<p><button id="test-add-restore">Restore original tree</button></p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-add-src"></pre>
		</div>
		
		<script id="test-add-src">
		(function() {
			var container = document.querySelector('#test-add'),
				notation = '((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;';
			var tree = new SVGTree(notation, container, {
				'interaction': ['add', 'remove', 'collapse']
			});
			
			$('#test-add-restore').click(function() {
				tree.setContent(notation);
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-drag"></div>
		</figure>
		<div class="notes">
			<p>Finally, you can allow to drag the nodes of the tree by including <code>'drag'</code> action 
			into the <code>interaction</code> option.
			You can select any of the three insertion points for a dragged subtree:</p>
			<ul>
				<li>before the node
				<li>after the node
				<li>as a child of the node
			</ul>
			<p>The active insertion point is marked with an arrow pointing in the direction the dragged subtree 
			is going to be inserted.</p>
			
			<p>If you press Ctrl key during drag, the subtree will be copied and not moved.</p>
			
			<p><button id="test-drag-restore">Restore original tree</button></p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-drag-src"></pre>
		</div>
		
		<script id="test-drag-src">
		(function() {
			var container = document.querySelector('#test-drag'),
				notation = '((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;';
			var tree = new SVGTree(notation, container, {
				'interaction': ['collapse', 'drag', 'remove']
			});
			
			$('#test-drag-restore').click(function() {
				tree.setContent(notation);
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<p>Note that nodes can be dragged between different trees that support drag-n-drop, e.g. the two trees to the bottom.</p>
	
		<div style="text-align: center;">
			<figure style="float: none; margin-right: 2em;">
				<div id="test-drag-2trees-1"></div>
			</figure>
			<figure style="float: none;">
				<div id="test-drag-2trees-2"></div>
			</figure>
		</div>
		
		<p><button id="test-drag-2trees-restore">Restore original trees</button></p>
		
		<h4>Code</h4>
		<pre class="code" data-script="test-drag-2trees-src"></pre>
		
		<script id="test-drag-2trees-src">
		(function() {
			var container1 = document.querySelector('#test-drag-2trees-1'),
				notation1 = '((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;';
			var tree1 = new SVGTree(notation1, container1, {
				'interaction': ['collapse', 'drag', 'remove']
			});
			
			var container2 = document.querySelector('#test-drag-2trees-2'),
				notation2 = '((1,2),(3,4),(5,6));';
			var tree2 = new SVGTree(notation2, container2, {
				'orientation': 'h',
				'interaction': ['collapse', 'drag', 'remove']
			});
			
			$('#test-drag-2trees-restore').click(function() {
				tree1.setContent(notation1);
				tree2.setContent(notation2);
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<figure>
			<div id="test-text-drag"></div>
		</figure>
		<div class="notes">
			By default, you can drag nodes only within the same tree or between trees on the same page. 
			To allow dragging text from outside sources, set <code>dragAsText</code> option to true.
			The dragged text is interpreted as Newick form of a subtree to be added to the tree.
			In case the Newick form is malformed, the text is used to create a single node.
			
			<p>The same option allows dropping nodes anywhere on the HTML page or other applications
			where the text input is expected. The dropped text is the Newick representation of the dragged subtree.</p>
			
			<p><b>Note.</b> Due to Microsoft being Microsoft, <code>dragAsText</code> option is effectively always true 
			in Internet Explorer.</p>
			
			<p>Try to drag a node here: <input type="text" size="40" /></p>
			
			<p><button id="test-text-drag-restore">Restore original tree</button></p>
			
			<h4>Code</h4>
			<pre class="code" data-script="test-text-drag-src"></pre>
		</div>
		
		<script id="test-text-drag-src">
		(function() {
			var container = document.querySelector('#test-text-drag'),
				notation = '((B,((F,((M,N,O)K,L)G)D,(H,I)E)C)A;';
			var tree = new SVGTree(notation, container, {
				'interaction': ['drag', 'remove'],
				'dragAsText': true
			});
			
			$('#test-text-drag-restore').click(function() {
				tree.setContent(notation);
			});
		})();
		</script>
	</div>
	
	<div class="row">
		<p>SVGTree can be used to visualize moderately big trees. For example, the tree below has 300 nodes.</p>

		<p><button id="test-max-gen">Generate a new tree</button></p>
		
		<div style="text-align: center;  margin-top: 3em;">
			<figure class="scroll">
				<div id="test-max"></div>
			</figure>
		</div>
		
		<h4>Code</h4>
		<pre class="code" data-script="test-max-src"></pre>
		
		<script id="test-max-src">
		(function() {
			// randomTree is a function that generates random trees
			// (you can inspect it by viewing the source code of this file).
		
			var container = document.querySelector('#test-max'),
				nodes = 300, // Number of nodes in the tree
				maxChildren = 4, // Maximum number of children of each node
				notation = randomTree(nodes, maxChildren).newick();
			var tree = new SVGTree(notation, container, {
				'interaction': ['collapse'],
				'size': 'fit'
			});
			
			$('#test-max-gen').click(function() {
				tree.setContent(randomTree(nodes, maxChildren).newick());
			});
		})();
		</script>
	</div>
</body>
</html>